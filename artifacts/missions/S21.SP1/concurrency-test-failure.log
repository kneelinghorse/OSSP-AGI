(node:96548) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL core tests/registration/concurrency.test.js
  Optimistic Locking Concurrency
    concurrent transitions
      ✓ should handle concurrent transitions with retry (35 ms)
      ✕ should handle multiple concurrent transitions (35 ms)
      ✓ should maintain state consistency under concurrent load (35 ms)
    retry behavior
      ✓ should retry on optimistic lock failure (21 ms)
    stress test
      ✓ should handle 10 concurrent writes without corruption (68 ms)

  ● Optimistic Locking Concurrency › concurrent transitions › should handle multiple concurrent transitions

    Event 'submit_for_review' not allowed in state 'REVIEWED'

      160 |             throw new Error(`No transitions defined for state ${fromState}`);
      161 |           }
    > 162 |           throw new Error(transitionCheck.reason);
          |                 ^
      163 |         }
      164 |
      165 |         const toState = transitionCheck.targetState;

      at packages/protocols/core/registration/registration-pipeline.js:162:17
      at computeNewState (packages/protocols/core/registration/optimistic-lock.js:182:28)
      at retryWithBackoff (packages/protocols/core/registration/optimistic-lock.js:88:14)
      at RegistrationPipeline.transitionState (packages/protocols/core/registration/registration-pipeline.js:137:31)
      at RegistrationPipeline.submitForReview (packages/protocols/core/registration/registration-pipeline.js:291:12)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/registration/concurrency.test.js:71:23)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 4 passed, 5 total
Snapshots:   0 total
Time:        0.537 s, estimated 1 s
Ran all test suites within paths "tests/registration/concurrency.test.js".

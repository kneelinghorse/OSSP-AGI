import{r as h,a as ee,R as te}from"./react-vendor-nf7bT_Uh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();var B={exports:{}},G={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se=h,ne=Symbol.for("react.element"),ae=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,re=se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,le={key:!0,ref:!0,__self:!0,__source:!0};function J(t,s,a){var n,i={},r=null,l=null;a!==void 0&&(r=""+a),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(l=s.ref);for(n in s)ie.call(s,n)&&!le.hasOwnProperty(n)&&(i[n]=s[n]);if(t&&t.defaultProps)for(n in s=t.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:ne,type:t,key:r,ref:l,props:i,_owner:re.current}}G.Fragment=ae;G.jsx=J;G.jsxs=J;B.exports=G;var e=B.exports,U={},V=ee;U.createRoot=V.createRoot,U.hydrateRoot=V.hydrateRoot;function ce({children:t}){return e.jsxs("div",{className:"layout",children:[e.jsx("header",{className:"layout-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{className:"header-title",children:"Protocol Viewer"}),e.jsx("p",{className:"header-subtitle",children:"OSS Protocol Discovery & Validation"})]})}),e.jsx("main",{className:"layout-main",children:t})]})}function oe({tabs:t,activeTab:s,onTabChange:a}){const n=h.useRef(null);h.useEffect(()=>{var l;const r=(l=n.current)==null?void 0:l.querySelector('[aria-selected="true"]');r&&document.activeElement===document.body&&r.focus()},[]);const i=(r,l)=>{let c=l;switch(r.key){case"ArrowRight":c=(l+1)%t.length;break;case"ArrowLeft":c=(l-1+t.length)%t.length;break;case"Home":c=0;break;case"End":c=t.length-1;break;default:return}r.preventDefault();const o=t[c];a(o.id),setTimeout(()=>{var u,p;const f=(u=n.current)==null?void 0:u.querySelectorAll('[role="tab"]');(p=f==null?void 0:f[c])==null||p.focus()},0)};return e.jsx("div",{className:"tab-nav",children:e.jsx("div",{className:"tab-list",role:"tablist","aria-label":"Protocol viewer sections",ref:n,children:t.map((r,l)=>{const c=r.id===s;return e.jsxs("button",{role:"tab",id:`tab-${r.id}`,"aria-selected":c,"aria-controls":`panel-${r.id}`,tabIndex:c?0:-1,className:`tab-button ${c?"active":""}`,onClick:()=>a(r.id),onKeyDown:o=>i(o,l),"data-semantic-tab":r.id,children:[e.jsx("span",{className:"tab-label",children:r.label}),r.count!==void 0&&e.jsx("span",{className:"tab-count","aria-label":`${r.count} items`,children:r.count})]},r.id)})})})}function M(t,s={}){return h.useMemo(()=>{if(!t)return{};const a={"data-semantic-urn":t,"data-semantic-type":s.type||"unknown"};return s.version&&(a["data-semantic-version"]=s.version),s.context&&(a["data-semantic-context"]=JSON.stringify(s.context)),a},[t,s.type,s.version,s.context])}function z(t,s={}){if(!t||!t.id)return{};const a={"data-semantic-urn":`urn:proto:manifest:${t.id}`,"data-semantic-type":"manifest","data-semantic-format":t.format||"unknown","data-semantic-path":t.path||""};return s.view&&(a["data-semantic-view"]=s.view),s.role&&(a["data-semantic-role"]=s.role),s.section&&(a["data-semantic-section"]=s.section),s.state&&(a["data-semantic-state"]=s.state),s.context&&(a["data-semantic-context"]=JSON.stringify(s.context)),a}function O({tabId:t,active:s,loading:a,error:n,children:i}){const r=a?"loading":n?"error":"ready",l=M(`urn:proto:viewer:${t}:panel`,{type:"tab-panel",context:{tabId:t,state:r}});return s?e.jsxs("div",{className:"tab-panel",role:"tabpanel",id:`panel-${t}`,"aria-labelledby":`tab-${t}`,tabIndex:0,"data-semantic-panel":t,"data-semantic-state":r,...l,children:[a&&e.jsxs("div",{className:"panel-state",children:[e.jsx("div",{className:"loading-spinner","aria-label":"Loading content",children:e.jsx("div",{className:"loading"})}),e.jsxs("p",{className:"state-message",children:["Loading ",t," data..."]})]}),n&&!a&&e.jsxs("div",{className:"panel-state error",children:[e.jsx("div",{className:"error-icon","aria-hidden":"true",children:"⚠️"}),e.jsxs("p",{className:"state-message error-message",children:["Failed to load ",t," data"]}),e.jsx("p",{className:"error-details",children:n.message})]}),!a&&!n&&e.jsx("div",{className:"panel-content",children:i})]}):null}const Y=h.createContext(null);function de({children:t}){const[s,a]=h.useState({activeTab:null,selectedManifest:null,activePanels:{},metadata:{},history:[]}),[n,i]=h.useState(!1),r=h.useCallback((d,m)=>{a(g=>({...g,activePanels:{...g.activePanels,[d]:{...m,registeredAt:new Date().toISOString()}},metadata:{...g.metadata,[d]:m}})),n&&console.log("[SemanticRegistry] Panel registered:",d,m)},[n]),l=h.useCallback(d=>{a(m=>{const{[d]:g,...v}=m.activePanels;return{...m,activePanels:v}}),n&&console.log("[SemanticRegistry] Panel unregistered:",d)},[n]),c=h.useCallback((d,m={})=>{a(g=>({...g,activeTab:d,history:[...g.history.slice(-19),{type:"tab-change",tabId:d,timestamp:new Date().toISOString()}]})),n&&console.log("[SemanticRegistry] Active tab changed:",d,m)},[n]),o=h.useCallback((d,m={})=>{a(g=>({...g,selectedManifest:d,metadata:{...g.metadata,selectedManifest:{id:d,urn:`urn:proto:manifest:${d}`,...m}},history:[...g.history.slice(-19),{type:"manifest-selected",manifestId:d,timestamp:new Date().toISOString()}]})),n&&console.log("[SemanticRegistry] Manifest selected:",d,m)},[n]),f=h.useCallback(()=>{a(d=>({...d,selectedManifest:null})),n&&console.log("[SemanticRegistry] Manifest selection cleared")},[n]),u=h.useCallback(()=>{i(d=>{const m=!d;return console.log(`[SemanticRegistry] Debug mode ${m?"enabled":"disabled"}`),m})},[]),p=h.useCallback(()=>({...s,timestamp:new Date().toISOString(),debugMode:n}),[s,n]);h.useEffect(()=>{const d=m=>{(m.ctrlKey||m.metaKey)&&m.shiftKey&&m.key==="D"&&(m.preventDefault(),u())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[u]);const j={registry:s,debugMode:n,registerPanel:r,unregisterPanel:l,setActiveTab:c,setSelectedManifest:o,clearSelectedManifest:f,toggleDebugMode:u,getSnapshot:p};return e.jsx(Y.Provider,{value:j,children:t})}function C(){const t=h.useContext(Y);if(!t)throw new Error("useSemanticRegistry must be used within SemanticRegistryProvider");return t}function P(t,s){const{registerPanel:a,unregisterPanel:n}=C();h.useEffect(()=>(t&&s&&a(t,s),()=>{t&&n(t)}),[t,a,n,s])}function ue({data:t}){var u;const s=(t==null?void 0:t.manifest_count)||((u=t==null?void 0:t.manifests)==null?void 0:u.count)||0,a=(t==null?void 0:t.status)||"unknown",n=t?a:"loading",i=M("urn:proto:viewer:health",{type:"health-status",context:{status:a,manifestCount:s}}),r=h.useMemo(()=>({urn:"urn:proto:viewer:health",type:"health-panel",context:{status:n,manifestCount:s}}),[n,s]);if(P("health",r),!t)return e.jsx("div",{className:"health-tab",...i,"data-semantic-state":n,children:"No health data available"});const{uptime:l,manifests:c,timestamp:o}=t,f=a==="ok";return e.jsxs("div",{className:"health-tab",...i,"data-semantic-state":n,children:[e.jsxs("div",{className:"health-header",children:[e.jsx("h2",{children:"System Health"}),e.jsxs("div",{className:`health-badge ${f?"healthy":"unhealthy"}`,children:[e.jsx("span",{className:"badge-indicator","aria-hidden":"true",children:"●"}),e.jsx("span",{className:"badge-text",children:f?"Healthy":"Unhealthy"})]})]}),e.jsxs("div",{className:"health-cards",children:[e.jsx(T,{title:"Server Status",value:a,icon:"🖥️",description:"API endpoint responding normally"}),e.jsx(T,{title:"Uptime",value:he(l),icon:"⏱️",description:"Time since server started"}),e.jsx(T,{title:"Manifests",value:s,icon:"📄",description:"Protocol manifests discovered"}),e.jsx(T,{title:"Last Updated",value:me(o),icon:"🕒",description:"Health check timestamp"})]}),(c==null?void 0:c.formats)&&e.jsxs("div",{className:"health-section",children:[e.jsx("h3",{children:"Manifest Formats"}),e.jsx("div",{className:"format-list",children:Object.entries(c.formats).map(([p,j])=>e.jsxs("div",{className:"format-item","data-semantic-format":p,children:[e.jsx("span",{className:"format-name",children:p}),e.jsx("span",{className:"format-count",children:j})]},p))})]})]})}function T({title:t,value:s,icon:a,description:n}){return e.jsxs("div",{className:"health-card",children:[e.jsx("div",{className:"card-icon","aria-hidden":"true",children:a}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"card-title",children:t}),e.jsx("div",{className:"card-value",children:s}),e.jsx("div",{className:"card-description",children:n})]})]})}function he(t){if(typeof t!="number")return"Unknown";const s=Math.floor(t/3600),a=Math.floor(t%3600/60),n=Math.floor(t%60);return s>0?`${s}h ${a}m`:a>0?`${a}m ${n}s`:`${n}s`}function me(t){if(!t)return"Unknown";const s=new Date(t),n=new Date-s,i=Math.floor(n/1e3);if(i<60)return"Just now";if(i<3600){const r=Math.floor(i/60);return`${r} minute${r!==1?"s":""} ago`}else if(i<86400){const r=Math.floor(i/3600);return`${r} hour${r!==1?"s":""} ago`}else return s.toLocaleString()}function pe({data:t}){const[s,a]=h.useState(null),[n,i]=h.useState(null),[r,l]=h.useState(!1),{setSelectedManifest:c,clearSelectedManifest:o}=C(),f=(t==null?void 0:t.length)||0,u=(s==null?void 0:s.filename)||(s==null?void 0:s.id)||null,p=M("urn:proto:viewer:manifests",{type:"manifest-panel",context:{manifestCount:f,selectedManifest:u}}),j=h.useMemo(()=>({urn:"urn:proto:viewer:manifests",type:"manifest-panel",context:{manifestCount:f,selectedManifest:u}}),[f,u]);if(P("manifests",j),!t||t.length===0)return e.jsx("div",{className:"manifests-tab",...p,"data-semantic-state":"empty",children:e.jsxs("div",{className:"empty-manifests",children:[e.jsx("span",{className:"empty-icon",children:"📭"}),e.jsx("p",{children:"No manifests found"})]})});const d=async g=>{var S;a(g),l(!0);const v=((S=g.filename)==null?void 0:S.replace(".json",""))||g.id;c(v,g);try{const k=g.filename||g.id,b=await fetch(`/api/manifest/${encodeURIComponent(k)}`);if(!b.ok)throw new Error("Failed to fetch manifest");const N=await b.json();i(N)}catch(k){console.error("Error fetching manifest detail:",k),i({error:k.message})}finally{l(!1)}},m=()=>{a(null),i(null),o()};return e.jsxs("div",{className:"manifests-tab",...p,"data-semantic-state":"loaded",children:[e.jsxs("div",{className:"manifests-header",children:[e.jsx("h2",{children:"Protocol Manifests"}),e.jsxs("div",{className:"manifests-count",children:[t.length," manifests"]})]}),e.jsx("div",{className:"manifests-list",children:t.map(g=>{const v=g.filename||g.id,S=(s==null?void 0:s.filename)||(s==null?void 0:s.id);return e.jsx(fe,{manifest:g,isSelected:S===v,onClick:()=>d(g)},v)})}),s&&e.jsx(ve,{manifest:s,data:n,loading:r,onClose:m})]})}function fe({manifest:t,isSelected:s,onClick:a}){var r;const n=((r=t.filename)==null?void 0:r.replace(".json",""))||t.id||"unknown",i=z({id:n,format:t.kind||t.format,path:t.filename},{view:"list-item",role:"manifest-list-item",state:s?"selected":"idle",context:{size:t.size||0,modified:t.modified||null}});return e.jsxs("div",{className:`manifest-item ${s?"selected":""}`,onClick:a,role:"button",tabIndex:0,onKeyDown:l=>l.key==="Enter"&&a(),...i,children:[e.jsxs("div",{className:"manifest-item-header","data-semantic-section":"header",children:[e.jsx("span",{className:"manifest-id","data-semantic-field":"manifest-id",children:n}),e.jsx("span",{className:`manifest-format ${t.kind||t.format||"unknown"}`,"data-semantic-field":"manifest-format",children:t.kind||t.format||"unknown"})]}),e.jsxs("div",{className:"manifest-item-meta","data-semantic-section":"meta",children:[t.urn&&e.jsx("span",{className:"manifest-urn",title:t.urn,"data-semantic-field":"manifest-urn",children:t.urn}),e.jsxs("span",{className:"manifest-size","data-semantic-field":"manifest-size",children:[ge(t.size)," • Modified ",xe(t.modified)]})]})]})}function ge(t){if(!t)return"0 B";const s=1024,a=["B","KB","MB"],n=Math.floor(Math.log(t)/Math.log(s));return Math.round(t/Math.pow(s,n)*10)/10+" "+a[n]}function xe(t){if(!t)return"Unknown";const s=new Date(t),n=new Date-s,i=Math.floor(n/6e4);if(i<60)return`${i}m ago`;const r=Math.floor(i/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function ve({manifest:t,data:s,loading:a,onClose:n}){var j;if(!t)return null;const i=((j=t.filename)==null?void 0:j.replace(".json",""))||t.id||"unknown",r=t.filename||`${i}.json`,l=t.urn||`urn:proto:manifest:${i}`,c=a?"loading":s!=null&&s.error?"error":"ready",o=z({id:i,format:t.kind||t.format,path:t.filename},{view:"detail",role:"manifest-detail",state:c,context:{filename:r,urn:l}}),f=h.useMemo(()=>({urn:l,type:"manifest-detail",context:{state:c,filename:r}}),[l,c,r]);P("manifest-detail",f);const u=h.useMemo(()=>!s||s.error?"":je(s),[s]),p=()=>{if(!s||s.error)return;const d=JSON.stringify(s,null,2),m=new Blob([d],{type:"application/json"}),g=URL.createObjectURL(m),v=document.createElement("a");v.href=g,v.download=r,v.click(),URL.revokeObjectURL(g)};return e.jsx("div",{className:"manifest-detail-overlay",onClick:n,"data-semantic-role":"manifest-detail-overlay",children:e.jsxs("div",{className:"manifest-detail",onClick:d=>d.stopPropagation(),...o,children:[e.jsxs("div",{className:"detail-header","data-semantic-section":"header",children:[e.jsxs("div",{className:"detail-title",children:[e.jsx("h3",{"data-semantic-field":"manifest-id",children:i}),e.jsx("span",{className:`manifest-format ${t.kind||t.format||"unknown"}`,"data-semantic-field":"manifest-format",children:t.kind||t.format||"unknown"})]}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("button",{className:"btn-download",onClick:p,disabled:a||(s==null?void 0:s.error),title:"Download manifest","data-semantic-action":"download-manifest","data-semantic-target":i,children:"⬇ Download"}),e.jsx("button",{className:"btn-close",onClick:n,title:"Close","data-semantic-action":"close-manifest-detail",children:"✕"})]})]}),e.jsxs("div",{className:"detail-meta","data-semantic-section":"meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"File:"}),e.jsx("span",{className:"meta-value","data-semantic-field":"manifest-file",children:r})]}),t.urn&&e.jsxs("div",{className:"meta-item",children:[e.jsx("span",{className:"meta-label",children:"URN:"}),e.jsx("span",{className:"meta-value","data-semantic-field":"manifest-urn",children:t.urn})]})]}),e.jsxs("div",{className:"detail-content","data-semantic-section":"content","data-semantic-state":c,children:[a&&e.jsxs("div",{className:"detail-loading",children:[e.jsx("div",{className:"loading"}),e.jsx("p",{children:"Loading manifest content..."})]}),!a&&(s==null?void 0:s.error)&&e.jsxs("div",{className:"detail-error",children:[e.jsx("p",{children:"⚠️ Failed to load manifest"}),e.jsx("pre",{children:s.error})]}),!a&&s&&!s.error&&e.jsx("pre",{className:"manifest-content","aria-live":"polite","data-semantic-section":"body","data-semantic-format":t.kind||t.format||"unknown",children:e.jsx("code",{dangerouslySetInnerHTML:{__html:u}})})]})]})})}function je(t){return(typeof t=="string"?t:JSON.stringify(t,null,2)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-fA-F0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/g,n=>{let i="number";return n.startsWith('"')?i=n.endsWith(":")?"key":"string":/true|false/.test(n)?i="boolean":/null/.test(n)&&(i="null"),`<span class="token ${i}">${n}</span>`})}function X({tabId:t,title:s,description:a,icon:n="🔨",data:i}){const r=M(`urn:proto:viewer:${t}`,{type:"placeholder",context:{status:"not-implemented"}});return e.jsx("div",{className:"placeholder-tab",...r,children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("div",{className:"placeholder-icon","aria-hidden":"true",children:n}),e.jsx("h2",{className:"placeholder-title",children:s}),e.jsx("p",{className:"placeholder-description",children:a}),i&&e.jsxs("div",{className:"placeholder-data",children:[e.jsx("h3",{children:"Preview Data"}),e.jsx("pre",{className:"data-preview",children:e.jsx("code",{children:JSON.stringify(i,null,2)})})]}),e.jsxs("div",{className:"placeholder-status",children:[e.jsx("span",{className:"status-badge",children:"Coming Soon"}),e.jsx("p",{className:"status-text",children:"This feature will be implemented in an upcoming mission"})]})]})})}function ye({data:t}){var r,l;const s=t?"loaded":"loading",a=((r=t==null?void 0:t.summary)==null?void 0:r.total)||((l=t==null?void 0:t.manifests)==null?void 0:l.length)||0,n=M("urn:proto:viewer:validation",{type:"validation-panel",context:{status:s,manifestCount:a}}),i=h.useMemo(()=>({urn:"urn:proto:viewer:validation",type:"validation-panel",context:{status:s,manifestCount:a}}),[s,a]);return P("validation",i),t?e.jsx("div",{className:"validation-tab",...n,"data-semantic-state":s,children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("div",{className:"placeholder-icon","aria-hidden":"true",children:"✓"}),e.jsx("h2",{className:"placeholder-title",children:"Manifest Validation"}),e.jsx("p",{className:"placeholder-description",children:"Validation results generated via the viewer API with semantic instrumentation"}),t.summary&&e.jsxs("div",{className:"data-summary","data-semantic-urn":"urn:proto:validation:summary",children:[e.jsx("h3",{children:"Validation Summary"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat","data-semantic-type":"validation-stat",children:[e.jsx("span",{className:"stat-label",children:"Total:"}),e.jsx("span",{className:"stat-value",children:t.summary.total})]}),e.jsxs("div",{className:"stat","data-semantic-type":"validation-stat",children:[e.jsx("span",{className:"stat-label",children:"Passed:"}),e.jsx("span",{className:"stat-value pass",children:t.summary.passed})]}),e.jsxs("div",{className:"stat","data-semantic-type":"validation-stat",children:[e.jsx("span",{className:"stat-label",children:"Warnings:"}),e.jsx("span",{className:"stat-value warning",children:t.summary.warnings})]}),e.jsxs("div",{className:"stat","data-semantic-type":"validation-stat",children:[e.jsx("span",{className:"stat-label",children:"Failed:"}),e.jsx("span",{className:"stat-value fail",children:t.summary.failed})]})]})]}),t.manifests&&e.jsxs("div",{className:"manifest-validations",children:[e.jsx("h3",{children:"Manifest Checks"}),t.manifests.map(c=>e.jsxs("div",{className:"validation-item","data-semantic-urn":c.urn,"data-semantic-type":"validation-result",children:[e.jsx("strong",{children:c.id}),e.jsx("span",{className:`status ${c.validationStatus}`,children:c.validationStatus})]},c.id))]}),e.jsxs("div",{className:"placeholder-status",children:[e.jsx("span",{className:"status-badge",children:"Live Data"}),e.jsx("p",{className:"status-text",children:"Powered by POST /api/validate"})]})]})}):e.jsx(X,{tabId:"validation",title:"Manifest Validation",description:"View validation results for protocol manifests, including schema compliance, breaking changes, and policy guardrails.",icon:"✓",data:null})}function be({data:t}){var l,c,o,f,u;const s=t?"loaded":"loading",a=((l=t==null?void 0:t.metadata)==null?void 0:l.nodeCount)||((c=t==null?void 0:t.nodes)==null?void 0:c.length)||0,n=((o=t==null?void 0:t.metadata)==null?void 0:o.edgeCount)||((f=t==null?void 0:t.edges)==null?void 0:f.length)||0,i=M("urn:proto:viewer:graph",{type:"graph-panel",context:{status:s,nodeCount:a,edgeCount:n}}),r=h.useMemo(()=>({urn:"urn:proto:viewer:graph",type:"graph-panel",context:{status:s,nodeCount:a,edgeCount:n}}),[s,a,n]);return P("graph",r),t?e.jsx("div",{className:"graph-tab",...i,"data-semantic-state":s,children:e.jsxs("div",{className:"placeholder-content",children:[e.jsx("div",{className:"placeholder-icon","aria-hidden":"true",children:"🕸️"}),e.jsx("h2",{className:"placeholder-title",children:"Protocol Graph"}),e.jsx("p",{className:"placeholder-description",children:"Graph index and chunks served from the viewer API with semantic instrumentation"}),t.metadata&&e.jsxs("div",{className:"data-summary","data-semantic-urn":"urn:proto:graph:metadata",children:[e.jsx("h3",{children:"Graph Metrics"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat","data-semantic-type":"graph-stat",children:[e.jsx("span",{className:"stat-label",children:"Nodes:"}),e.jsx("span",{className:"stat-value",children:t.metadata.nodeCount})]}),e.jsxs("div",{className:"stat","data-semantic-type":"graph-stat",children:[e.jsx("span",{className:"stat-label",children:"Edges:"}),e.jsx("span",{className:"stat-value",children:t.metadata.edgeCount})]}),e.jsxs("div",{className:"stat","data-semantic-type":"graph-stat",children:[e.jsx("span",{className:"stat-label",children:"Depth:"}),e.jsx("span",{className:"stat-value",children:t.metadata.depth})]})]})]}),((u=t.metadata)==null?void 0:u.partition)&&e.jsxs("div",{className:"partition-summary","data-semantic-urn":"urn:proto:graph:partition","data-semantic-type":"graph-partition-summary",children:[e.jsx("h3",{children:"Partition Summary"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Parts:"}),e.jsx("span",{className:"stat-value",children:t.metadata.partition.totalParts})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Max Size:"}),e.jsx("span",{className:"stat-value",children:t.metadata.partition.maxSize})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-label",children:"Avg Size:"}),e.jsx("span",{className:"stat-value",children:Math.round(t.metadata.partition.avgSize??0)})]})]})]}),Array.isArray(t.parts)&&t.parts.length>0&&e.jsxs("div",{className:"partition-list","data-semantic-urn":"urn:proto:graph:partition:list","data-semantic-type":"graph-partition-list",children:[e.jsx("h3",{children:"Partition Samples"}),t.parts.slice(0,3).map(p=>e.jsxs("div",{className:"partition-item","data-semantic-type":"graph-partition","data-semantic-part-id":p.id,children:[e.jsx("strong",{children:p.id}),e.jsxs("span",{className:"partition-nodes",children:[p.nodes," nodes"]}),e.jsxs("span",{className:"partition-edges",children:[p.edges," edges"]})]},p.id)),t.parts.length>3&&e.jsxs("p",{className:"partition-footnote",children:["Showing ",Math.min(3,t.parts.length)," of ",t.parts.length," partitions"]})]}),Array.isArray(t.nodes)&&t.nodes.length>0&&e.jsxs("div",{className:"graph-nodes",children:[e.jsx("h3",{children:"Protocol Nodes"}),t.nodes.slice(0,12).map(p=>e.jsxs("div",{className:"graph-node-item","data-semantic-urn":p.urn,"data-semantic-type":"graph-node","data-semantic-node-type":p.type,children:[e.jsx("strong",{children:p.id}),e.jsx("span",{className:"node-format",children:p.format})]},p.id)),t.nodes.length>12&&e.jsxs("p",{className:"partition-footnote",children:["Showing 12 of ",t.nodes.length," nodes"]})]}),e.jsxs("div",{className:"placeholder-status",children:[e.jsx("span",{className:"status-badge",children:"Live Data"}),e.jsx("p",{className:"status-text",children:"Powered by POST /api/graph"})]})]})}):e.jsx(X,{tabId:"graph",title:"Protocol Graph",description:"Visualize protocol dependencies, service relationships, and data flow across your distributed system.",icon:"🕸️",data:null})}function Ne(){const{registry:t,debugMode:s,toggleDebugMode:a,getSnapshot:n}=C(),[i,r]=h.useState(!1),[l,c]=h.useState("registry");if(!s)return null;const o=()=>{const u=n(),p=JSON.stringify(u,null,2);navigator.clipboard.writeText(p).then(()=>{console.log("[SemanticDebugPanel] Registry snapshot copied to clipboard")})},f=()=>{const u=n(),p=JSON.stringify(u,null,2),j=new Blob([p],{type:"application/json"}),d=URL.createObjectURL(j),m=document.createElement("a");m.href=d,m.download=`semantic-registry-${Date.now()}.json`,m.click(),URL.revokeObjectURL(d)};return e.jsxs("div",{className:`semantic-debug-panel ${i?"collapsed":""}`,children:[e.jsxs("div",{className:"debug-header",children:[e.jsxs("div",{className:"debug-title",children:[e.jsx("span",{className:"debug-icon",children:"🔍"}),e.jsx("span",{children:"Semantic Registry"}),e.jsx("span",{className:"debug-badge",children:"Debug"})]}),e.jsxs("div",{className:"debug-actions",children:[e.jsx("button",{className:"debug-btn",onClick:()=>r(!i),title:i?"Expand":"Collapse",children:i?"▲":"▼"}),e.jsx("button",{className:"debug-btn",onClick:a,title:"Close (Ctrl+Shift+D)",children:"✕"})]})]}),!i&&e.jsxs("div",{className:"debug-content",children:[e.jsxs("div",{className:"debug-tabs",children:[e.jsx("button",{className:`debug-tab ${l==="registry"?"active":""}`,onClick:()=>c("registry"),children:"Registry"}),e.jsx("button",{className:`debug-tab ${l==="history"?"active":""}`,onClick:()=>c("history"),children:"History"}),e.jsx("button",{className:`debug-tab ${l==="attributes"?"active":""}`,onClick:()=>c("attributes"),children:"Attributes"})]}),e.jsxs("div",{className:"debug-view",children:[l==="registry"&&e.jsx(we,{registry:t}),l==="history"&&e.jsx(_e,{history:t.history}),l==="attributes"&&e.jsx(Se,{})]}),e.jsxs("div",{className:"debug-footer",children:[e.jsx("button",{className:"debug-btn-small",onClick:o,children:"📋 Copy Snapshot"}),e.jsx("button",{className:"debug-btn-small",onClick:f,children:"💾 Export JSON"}),e.jsx("span",{className:"debug-hint",children:"Ctrl+Shift+D to toggle"})]})]})]})}function we({registry:t}){const{activeTab:s,selectedManifest:a,activePanels:n,metadata:i}=t;return e.jsxs("div",{className:"debug-section",children:[e.jsxs("div",{className:"debug-row",children:[e.jsx("span",{className:"debug-label",children:"Active Tab:"}),e.jsx("span",{className:"debug-value",children:s||"none"})]}),e.jsxs("div",{className:"debug-row",children:[e.jsx("span",{className:"debug-label",children:"Selected Manifest:"}),e.jsx("span",{className:"debug-value",children:a||"none"})]}),e.jsxs("div",{className:"debug-subsection",children:[e.jsxs("h4",{children:["Active Panels (",Object.keys(n).length,")"]}),Object.keys(n).length===0?e.jsx("p",{className:"debug-empty",children:"No active panels"}):e.jsx("div",{className:"debug-list",children:Object.entries(n).map(([r,l])=>e.jsxs("div",{className:"debug-item",children:[e.jsxs("div",{className:"debug-item-header",children:[e.jsx("strong",{children:r}),e.jsx("span",{className:"debug-timestamp",children:new Date(l.registeredAt).toLocaleTimeString()})]}),e.jsx("pre",{className:"debug-code",children:JSON.stringify(l,null,2)})]},r))})]}),e.jsxs("div",{className:"debug-subsection",children:[e.jsxs("h4",{children:["Metadata (",Object.keys(i).length,")"]}),Object.keys(i).length===0?e.jsx("p",{className:"debug-empty",children:"No metadata"}):e.jsx("pre",{className:"debug-code",children:JSON.stringify(i,null,2)})]})]})}function _e({history:t}){return!t||t.length===0?e.jsx("p",{className:"debug-empty",children:"No history recorded"}):e.jsx("div",{className:"debug-section",children:e.jsx("div",{className:"debug-list",children:t.slice().reverse().map((s,a)=>e.jsxs("div",{className:"debug-history-item",children:[e.jsxs("div",{className:"debug-history-header",children:[e.jsx("span",{className:"debug-history-type",children:s.type}),e.jsx("span",{className:"debug-timestamp",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{className:"debug-history-details",children:[s.tabId&&e.jsxs("span",{children:["Tab: ",s.tabId]}),s.manifestId&&e.jsxs("span",{children:["Manifest: ",s.manifestId]})]})]},a))})})}function Se(){const[t,s]=h.useState([]);return h.useEffect(()=>{const a=()=>{const i=document.querySelectorAll("[data-semantic-urn], [data-semantic-type], [data-semantic-panel], [data-semantic-tab]"),r=Array.from(i).map(l=>{const c={};return Array.from(l.attributes).forEach(o=>{o.name.startsWith("data-semantic-")&&(c[o.name]=o.value)}),{tagName:l.tagName.toLowerCase(),id:l.id,className:l.className,attributes:c}});s(r)};a();const n=new MutationObserver(a);return n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-semantic-urn","data-semantic-type","data-semantic-panel","data-semantic-tab"]}),()=>n.disconnect()},[]),e.jsxs("div",{className:"debug-section",children:[e.jsxs("p",{className:"debug-info",children:["Found ",t.length," element(s) with semantic attributes"]}),t.length===0?e.jsx("p",{className:"debug-empty",children:"No semantic attributes in DOM"}):e.jsx("div",{className:"debug-list",children:t.map((a,n)=>e.jsxs("div",{className:"debug-item",children:[e.jsxs("div",{className:"debug-item-header",children:[e.jsxs("code",{children:["<",a.tagName,">"]}),a.id&&e.jsxs("span",{className:"debug-id",children:["#",a.id]})]}),e.jsx("pre",{className:"debug-code",children:JSON.stringify(a.attributes,null,2)})]},n))})]})}const Q=h.createContext(null);function ke(){return localStorage.getItem("ossProto:inspectionEnabled")==="true"}function Ae(t){if(!t)return null;const s=t.getAttribute("data-semantic-urn");return s?{urn:s,type:t.getAttribute("data-semantic-type")||"unknown",version:t.getAttribute("data-semantic-version"),format:t.getAttribute("data-semantic-format"),path:t.getAttribute("data-semantic-path"),view:t.getAttribute("data-semantic-view"),role:t.getAttribute("data-semantic-role"),section:t.getAttribute("data-semantic-section"),state:t.getAttribute("data-semantic-state"),context:t.getAttribute("data-semantic-context"),validationType:t.getAttribute("data-semantic-validation-type"),nodeType:t.getAttribute("data-semantic-node-type")}:null}function Me(t){var i;let s=t;const a=10;let n=0;for(;s&&n<a;){if((i=s.getAttribute)!=null&&i.call(s,"data-semantic-urn"))return s;s=s.parentElement,n++}return null}function Ee({children:t}){const[s,a]=h.useState({active:!1,targetElement:null,semanticAttrs:null,position:{x:0,y:0}}),{registry:n,getSnapshot:i}=C(),r=h.useRef(null),l=ke(),c=h.useCallback((d,m,g,v)=>{l&&(r.current=document.activeElement,a({active:!0,targetElement:d,semanticAttrs:m,position:{x:g,y:v}}))},[l]),o=h.useCallback(()=>{if(a({active:!1,targetElement:null,semanticAttrs:null,position:{x:0,y:0}}),r.current&&typeof r.current.focus=="function")try{r.current.focus()}catch{}r.current=null},[]),f=h.useCallback(d=>{if(!l||!d.altKey)return;const m=Me(d.target);if(!m)return;d.preventDefault(),d.stopPropagation();const g=Ae(m);g&&(s.active&&s.targetElement===m?o():c(m,g,d.clientX,d.clientY))},[l,s.active,s.targetElement,c,o]),u=h.useCallback(d=>{if(l){if(d.key==="Escape"&&s.active){d.preventDefault(),o();return}(d.ctrlKey||d.metaKey)&&d.shiftKey&&d.key==="I"&&(d.preventDefault(),s.active?o():a({active:!0,targetElement:null,semanticAttrs:null,position:{x:window.innerWidth/2,y:100}}))}},[l,s.active,o]);h.useEffect(()=>{if(l)return document.addEventListener("click",f,!0),document.addEventListener("keydown",u),()=>{document.removeEventListener("click",f,!0),document.removeEventListener("keydown",u)}},[l,f,u]);const p=h.useCallback(()=>{var m,g;if(!s.active)return null;const d=i();return{element:{tag:(m=s.targetElement)==null?void 0:m.tagName,className:(g=s.targetElement)==null?void 0:g.className,attributes:s.semanticAttrs},registry:{activeTab:d.activeTab,selectedManifest:d.selectedManifest,activePanels:d.activePanels,metadata:d.metadata},timestamp:d.timestamp}},[s,i]),j={enabled:l,inspectionState:s,activate:c,deactivate:o,getInspectionData:p};return e.jsx(Q.Provider,{value:j,children:t})}function Ce(){const t=h.useContext(Q);if(!t)throw new Error("useInspectionOverlay must be used within InspectionOverlayProvider");return t}function Pe(){const{enabled:t,inspectionState:s,deactivate:a,getInspectionData:n}=Ce(),{position:i,targetElement:r,active:l}=s,c=De(l?r:null),o=t&&l,f=h.useMemo(()=>{if(o&&c){const g=window.innerWidth,v=window.innerHeight,S=g-c.right-16,k=c.left-16;let b;S>=416?b=c.right+16:k>=416?b=c.left-400-16:b=c.left+c.width/2-400/2,b=Math.min(Math.max(b,16),g-400-16);let N=c.top;return N+320>v-16&&(N=v-320-16),N=Math.max(N,16),{left:b,top:N}}return{left:Math.min(i.x+20,window.innerWidth-400-16),top:Math.min(i.y+20,window.innerHeight-320)}},[i.x,i.y,c,o]);if(!o)return null;const u=n();return e.jsxs(e.Fragment,{children:[r&&c&&e.jsx(Re,{element:r,rect:c}),e.jsxs("div",{className:"inspection-overlay",style:f,children:[e.jsxs("div",{className:"inspection-overlay__header",children:[e.jsx("span",{className:"inspection-overlay__title",children:"🔍 Semantic Inspector"}),e.jsx("button",{className:"inspection-overlay__close",onClick:a,"aria-label":"Close inspector",children:"×"})]}),e.jsxs("div",{className:"inspection-overlay__content",children:[u.element.attributes&&e.jsx(L,{title:"Element Attributes",children:e.jsx(Oe,{attributes:u.element.attributes})}),e.jsxs(L,{title:"Registry Context",children:[e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"Active Tab:"}),e.jsx("span",{className:"inspection-field__value",children:u.registry.activeTab||"none"})]}),u.registry.selectedManifest&&e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"Selected Manifest:"}),e.jsx("span",{className:"inspection-field__value",children:u.registry.selectedManifest})]}),e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"Active Panels:"}),e.jsx("span",{className:"inspection-field__value",children:Object.keys(u.registry.activePanels).length})]})]}),e.jsx(L,{title:"Panel Metadata",children:Object.keys(u.registry.activePanels).length>0?e.jsx(Te,{panels:u.registry.activePanels}):e.jsx("div",{className:"inspection-empty",children:"No active panels"})}),u.registry.metadata.selectedManifest&&e.jsx(L,{title:"Manifest Details",children:e.jsx($e,{manifest:u.registry.metadata.selectedManifest})})]}),e.jsx("div",{className:"inspection-overlay__footer",children:e.jsxs("span",{className:"inspection-overlay__hint",children:["Press ",e.jsx("kbd",{children:"Esc"})," to close • ",e.jsx("kbd",{children:"Alt+Click"})," another element"]})})]}),e.jsx("div",{className:"inspection-overlay-backdrop",onClick:a})]})}function Re({element:t,rect:s}){if(!t||!s)return null;const a={position:"fixed",left:`${s.left}px`,top:`${s.top}px`,width:`${s.width}px`,height:`${s.height}px`,pointerEvents:"none",zIndex:999998};return e.jsx("div",{className:"inspection-highlight",style:a,children:e.jsx("div",{className:"inspection-highlight__badge",children:t.getAttribute("data-semantic-type")||"element"})})}function De(t){const[s,a]=h.useState(()=>t?$(t.getBoundingClientRect()):null);return h.useEffect(()=>{if(!t){a(null);return}const n=typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame:o=>setTimeout(()=>o(Date.now()),16),i=typeof window<"u"&&typeof window.cancelAnimationFrame=="function"?window.cancelAnimationFrame:clearTimeout;let r,l=$(t.getBoundingClientRect());a(l);const c=()=>{const o=$(t.getBoundingClientRect());K(l,o)||(l=o,a(o)),r=n(c)};return r=n(c),()=>{r!==void 0&&i(r)}},[t]),h.useEffect(()=>{if(!t||typeof ResizeObserver!="function")return;const n=new ResizeObserver(()=>{const i=$(t.getBoundingClientRect());a(r=>r&&K(r,i)?r:i)});return n.observe(t),()=>n.disconnect()},[t]),s}function $(t){if(!t)return null;const{top:s,left:a,right:n,bottom:i,width:r,height:l}=t;return{top:s,left:a,right:n,bottom:i,width:r,height:l}}function K(t,s){if(!t||!s)return!1;const a=.5;return Math.abs(t.top-s.top)<a&&Math.abs(t.left-s.left)<a&&Math.abs(t.right-s.right)<a&&Math.abs(t.bottom-s.bottom)<a&&Math.abs(t.width-s.width)<a&&Math.abs(t.height-s.height)<a}function L({title:t,children:s}){return e.jsxs("div",{className:"inspection-section",children:[e.jsx("h3",{className:"inspection-section__title",children:t}),e.jsx("div",{className:"inspection-section__body",children:s})]})}function Oe({attributes:t}){const s=Object.entries(t).filter(([a,n])=>n!=null);return s.length===0?e.jsx("div",{className:"inspection-empty",children:"No attributes"}):e.jsx("div",{className:"inspection-attributes",children:s.map(([a,n])=>e.jsxs("div",{className:"inspection-field",children:[e.jsxs("span",{className:"inspection-field__label",children:[a,":"]}),e.jsx("span",{className:"inspection-field__value",title:n,children:typeof n=="string"&&n.length>40?`${n.substring(0,40)}...`:n})]},a))})}function Te({panels:t}){return e.jsx("div",{className:"inspection-panels",children:Object.entries(t).map(([s,a])=>e.jsxs("div",{className:"inspection-panel-item",children:[e.jsxs("div",{className:"inspection-panel-item__header",children:[e.jsx("span",{className:"inspection-panel-item__id",children:s}),e.jsx("span",{className:"inspection-panel-item__type",children:a.type})]}),a.urn&&e.jsx("div",{className:"inspection-panel-item__urn",title:a.urn,children:a.urn})]},s))})}function $e({manifest:t}){return e.jsxs("div",{className:"inspection-manifest",children:[e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"ID:"}),e.jsx("span",{className:"inspection-field__value",children:t.id})]}),e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"URN:"}),e.jsx("span",{className:"inspection-field__value",title:t.urn,children:t.urn})]}),t.format&&e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"Format:"}),e.jsx("span",{className:"inspection-field__value",children:t.format})]}),t.path&&e.jsxs("div",{className:"inspection-field",children:[e.jsx("span",{className:"inspection-field__label",children:"Path:"}),e.jsx("span",{className:"inspection-field__value",title:t.path,children:t.path.length>35?`...${t.path.slice(-35)}`:t.path})]})]})}const Le="/graph/worker.js",I=4,He=15e3;function Z(){return typeof Worker<"u"}function Fe(t){return new Promise((s,a)=>{if(!Z()){a(new Error("Web Workers not supported"));return}let n,i=!1;const r=new Worker(Le),l=()=>{i||(i=!0,typeof n=="number"&&clearTimeout(n),r.terminate())};n=setTimeout(()=>{l(),a(new Error(`Worker timed out fetching ${t}`))},He),r.onmessage=c=>{var o,f;l(),(o=c.data)!=null&&o.ok?s(c.data.data):a(new Error(((f=c.data)==null?void 0:f.error)||"Worker failed to parse partition"))},r.onerror=c=>{l(),a(c instanceof Error?c:new Error(String(c)))},r.postMessage({partUrl:t})})}function Ge(t,{signal:s,highPriority:a=!1}={}){return new Promise((n,i)=>{const r=()=>{fetch(t,{signal:s}).then(u=>{if(!u.ok)throw new Error(`Failed to fetch partition ${t} (${u.status})`);return u.json()}).then(n).catch(i)};if(typeof window>"u"){r();return}const l=typeof window.requestIdleCallback=="function";let c=null,o=null;(()=>{if(!l||a){const p=setTimeout(()=>{r()},a?0:16);s&&(o=()=>{clearTimeout(p),i(new DOMException("Aborted","AbortError"))},s.addEventListener("abort",o,{once:!0}));return}c=window.requestIdleCallback(()=>{r()},{timeout:200}),s&&(o=()=>{c!==null&&typeof window.cancelIdleCallback=="function"&&window.cancelIdleCallback(c),i(new DOMException("Aborted","AbortError"))},s.addEventListener("abort",o,{once:!0}))})()})}async function q(t,s={}){const{useWorker:a=!0,signal:n,highPriority:i=!1}=s;if(!(t!=null&&t.url))throw new Error("Partition descriptor missing url");if(a&&Z())try{return await Fe(t.url)}catch{}return Ge(t.url,{signal:n,highPriority:i})}async function We(t,s={}){const{useWorker:a=!0,maxConcurrent:n=I,signal:i,onPartLoaded:r}=s,l=Array.isArray(t==null?void 0:t.parts)?t.parts:[];if(!l.length)return{chunks:[],nodes:[],edges:[],index:(t==null?void 0:t.index)??null};const c=Math.max(1,Number(n)||I),o=new Map,f=[],u=l[0],p=await q(u,{useWorker:a,signal:i,highPriority:!0});o.set(u.id,p),f.push(u.id),r==null||r({part:u,chunk:p,index:0});const j=l.slice(1);for(let v=0;v<j.length;v+=c){const S=j.slice(v,v+c);if((await Promise.all(S.map(async b=>{const N=await q(b,{useWorker:a,signal:i});return{part:b,chunk:N}}))).forEach(({part:b,chunk:N})=>{o.set(b.id,N),f.push(b.id);const x=l.findIndex(y=>y.id===b.id);r==null||r({part:b,chunk:N,index:x})}),i!=null&&i.aborted)break}const d=l.map(v=>({part:v,chunk:o.get(v.id)})).filter(v=>!!v.chunk),m=[],g=[];for(const{chunk:v}of d)Array.isArray(v.nodes)&&m.push(...v.nodes),Array.isArray(v.edges)&&g.push(...v.edges);return{chunks:d,nodes:m,edges:g,index:(t==null?void 0:t.index)??null}}async function Ue({manifests:t,seed:s,signal:a}){if(s){const i=encodeURIComponent(s),r=`/graph/seeds/${i}/index.json`;typeof window<"u"&&console.log("[graph] fetchGraphIndex requesting seed",s,{staticUrl:r});try{const o=await fetch(r,{signal:a,cache:"force-cache"});if(o.ok)return typeof window<"u"&&console.log("[graph] fetchGraphIndex seed served from static assets"),o.json();typeof window<"u"&&console.warn("[graph] static seed fetch failed",o.status)}catch(o){typeof window<"u"&&console.warn("[graph] static seed fetch error",o)}const l=`/api/graph/seed/${i}`,c=await fetch(l,{signal:a});if(typeof window<"u"&&console.log("[graph] fetchGraphIndex seed status",c.status),!c.ok)throw new Error(`Seed graph request failed (${c.status})`);return c.json()}typeof window<"u"&&console.log("[graph] fetchGraphIndex requesting manifests",t.length);const n=await fetch("/api/graph",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({manifests:t}),signal:a});if(typeof window<"u"&&console.log("[graph] fetchGraphIndex manifest status",n.status),!n.ok)throw new Error(`Graph index request failed (${n.status})`);return n.json()}function Ie(t,s){const a=(t==null?void 0:t.index)??{},n=a.partition??null;return{nodeCount:a.node_count??s.nodes.length,edgeCount:a.edge_count??s.edges.length,depth:a.depth??0,partition:n}}async function Ve(t=[],s={}){var p,j;const{seed:a,useWorker:n=!0,maxConcurrent:i=I,signal:r,onIndex:l,onPartLoaded:c}=s;typeof window<"u"&&console.log("[graph] loader.getGraph init",{seed:a,manifestCount:t.length,useWorker:n,maxConcurrent:i});const o=await Ue({manifests:t,seed:a,signal:r});typeof window<"u"&&console.log("[graph] loader.getGraph index",{parts:((p=o==null?void 0:o.parts)==null?void 0:p.length)??0,nodeCount:((j=o==null?void 0:o.index)==null?void 0:j.node_count)??null}),l==null||l(o);const f=await We(o,{useWorker:n,maxConcurrent:i,signal:r,onPartLoaded:c}),u=Ie(o,f);return typeof window<"u"&&console.log("[graph] loader.getGraph complete",{nodes:f.nodes.length,edges:f.edges.length,parts:f.chunks.length}),{source:a?"seed":"live",index:o.index??null,parts:o.parts??[],chunks:f.chunks,nodes:f.nodes,edges:f.edges,metadata:u}}const Ke="/api";class A extends Error{constructor(s,a,n){super(s),this.name="ApiError",this.status=a,this.data=n}}async function H(t,s={}){const a=`${Ke}${t}`;try{const n=await fetch(a,{headers:{"Content-Type":"application/json",...s.headers},...s});let i;const r=n.headers.get("content-type");if(r&&r.includes("application/json")?i=await n.json():i=await n.text(),!n.ok){const l=(i==null?void 0:i.error)||(i==null?void 0:i.message)||`Request failed with status ${n.status}`;throw new A(l,n.status,i)}return i}catch(n){throw n instanceof A?n:new A(n.message||"Network request failed",0,null)}}const F={async _resolveManifestFiles(t=[]){let s=t;(!Array.isArray(s)||s.length===0)&&(s=await this.getManifests());const a=s.map(n=>{if(typeof n=="string")return n.endsWith(".json")?n:`${n}.json`;if(n&&typeof n=="object"){if(typeof n.filename=="string")return n.filename;if(typeof n.id=="string")return n.id.endsWith(".json")?n.id:`${n.id}.json`;if(typeof n.urn=="string"){const i=n.urn.split(":").pop();return i?`${i.includes("@")?i.split("@")[0]:i}.json`:null}}return null}).filter(Boolean);return[...new Set(a)]},async getHealth(){return H("/health")},async getManifests(){const t=await H("/manifests");return Array.isArray(t)?t:(t==null?void 0:t.manifests)||[]},async getManifest(t){return H(`/manifest/${encodeURIComponent(t)}`)},async getValidation(t=[]){const s=await this._resolveManifestFiles(t);if(s.length===0)throw new A("No manifests available for validation",404,null);const a=await H("/validate",{method:"POST",body:JSON.stringify({manifests:s})});return{...a,source:"live",summary:a.summary||{total:0,passed:0,warnings:0,failed:0},manifests:a.manifests||[]}},async getGraph(t=[],s={}){var f,u;const{seed:a=null,useWorker:n,maxConcurrent:i,onPartLoaded:r}=s;let l=[];if(!a&&(l=await this._resolveManifestFiles(t),l.length===0))throw new A("No manifests available for graph generation",404,null);if(typeof window<"u"){const p={seed:a,manifests:l.length,useWorker:typeof window<"u"?n!==!1:!1};console.log("[graph] api.getGraph request",p)}const c=await Ve(l,{seed:a,useWorker:typeof window<"u"?n!==!1:!1,maxConcurrent:i,onPartLoaded:r}),o=((u=(f=c.chunks)==null?void 0:f[0])==null?void 0:u.chunk)??null;return{...c,manifests:l,primary:o}},async getGovernance(){throw new A("Governance dashboard is disabled in Sprint 21 builds. See docs/SPRINT_21_SURFACE_CHANGES.md#viewer-changes for context.",501,{documentation:"docs/SPRINT_21_SURFACE_CHANGES.md#viewer-changes",guidance:["The viewer focuses on health, manifests, validation, and graph exploration.","Use protocol_report_governance via the CLI to generate static governance reports.","Follow docs/runtime/runtime-usage-guide.md for supported runtime operations."]})}};function qe(){const[t,s]=h.useState(()=>typeof window<"u"&&new URLSearchParams(window.location.search).get("seed")?"graph":"health"),{setActiveTab:a}=C(),[n,i]=h.useState(null),[r,l]=h.useState(null),[c,o]=h.useState(null),[f,u]=h.useState(null),[p,j]=h.useState({health:!0,manifests:!0,validation:!1,graph:!1}),[d,m]=h.useState({health:null,manifests:null,validation:null,graph:null});h.useEffect(()=>{g(),v()},[]),h.useEffect(()=>{t==="validation"&&!c&&!p.validation?S():t==="graph"&&!f&&!p.graph&&k()},[t]);const g=async()=>{try{j(y=>({...y,health:!0})),m(y=>({...y,health:null}));const x=await F.getHealth();i(x)}catch(x){m(y=>({...y,health:x})),console.error("Failed to fetch health:",x)}finally{j(x=>({...x,health:!1}))}},v=async()=>{try{j(y=>({...y,manifests:!0})),m(y=>({...y,manifests:null}));const x=await F.getManifests();l(x)}catch(x){m(y=>({...y,manifests:x})),console.error("Failed to fetch manifests:",x)}finally{j(x=>({...x,manifests:!1}))}},S=async()=>{try{j(y=>({...y,validation:!0})),m(y=>({...y,validation:null}));const x=await F.getValidation();o(x)}catch(x){m(y=>({...y,validation:x})),console.error("Failed to fetch validation:",x)}finally{j(x=>({...x,validation:!1}))}},k=async()=>{try{j(_=>({..._,graph:!0})),m(_=>({..._,graph:null}));const x=performance.now();window.__GRAPH_READY__=!1;const W=new URLSearchParams(window.location.search).get("seed");let R=!1;typeof window<"u"&&(window.__FETCH_GRAPH_CALLS__=(window.__FETCH_GRAPH_CALLS__||0)+1,console.log(`[graph] fetchGraph call #${window.__FETCH_GRAPH_CALLS__}`,{seed:W}));const D=await F.getGraph(void 0,{seed:W,useWorker:!0,maxConcurrent:4,onIndex:_=>{u(E=>{if(E)return E;const w=_.index??null;return{index:w,parts:_.parts??[],nodes:[],edges:[],metadata:{nodeCount:(w==null?void 0:w.node_count)??0,edgeCount:(w==null?void 0:w.edge_count)??0,depth:(w==null?void 0:w.depth)??0,partition:(w==null?void 0:w.partition)??null},source:W?"seed":"live"}})},onPartLoaded:({index:_})=>{if(!R&&_===0){R=!0;const E=Math.round(performance.now()-x);window.__GRAPH_READY__=!0,window.__GRAPH_READY_MS=E,console.log(`[graphReady]=${E}`)}}});if(!R){R=!0;const _=Math.round(performance.now()-x);window.__GRAPH_READY__=!0,window.__GRAPH_READY_MS=_,console.log(`[graphReady]=${_}`)}u(D),typeof window<"u"&&(window.__GRAPH_METADATA__={index:D.index,parts:D.parts,metadata:D.metadata})}catch(x){m(y=>({...y,graph:x})),console.error("Failed to fetch graph:",x)}finally{j(x=>({...x,graph:!1}))}},b=[{id:"health",label:"Health",count:n?1:void 0},{id:"manifests",label:"Manifests",count:(r==null?void 0:r.length)||0},{id:"validation",label:"Validation"},{id:"graph",label:"Graph"}],N=x=>{s(x)};return h.useEffect(()=>{a(t)},[t,a]),e.jsxs(ce,{children:[e.jsx(oe,{tabs:b,activeTab:t,onTabChange:N}),e.jsx(O,{tabId:"health",active:t==="health",loading:p.health,error:d.health,children:e.jsx(ue,{data:n})}),e.jsx(O,{tabId:"manifests",active:t==="manifests",loading:p.manifests,error:d.manifests,children:e.jsx(pe,{data:r})}),e.jsx(O,{tabId:"validation",active:t==="validation",loading:p.validation,error:d.validation,children:e.jsx(ye,{data:c})}),e.jsx(O,{tabId:"graph",active:t==="graph",loading:p.graph,error:d.graph,children:e.jsx(be,{data:f})}),e.jsx(Ne,{}),e.jsx(Pe,{})]})}function Be(){return e.jsx(de,{children:e.jsx(Ee,{children:e.jsx(qe,{})})})}U.createRoot(document.getElementById("root")).render(e.jsx(te.StrictMode,{children:e.jsx(Be,{})}));
